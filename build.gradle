// build.gradle for ComplianceSys project
// Configures project dependencies and build tasks.

plugins {
    // Aplica o plugin Java para funcionalidades de compilação e teste.
    id 'java'
    // Aplica o plugin WAR para construir um arquivo .war para implantação em servidores de aplicação como o Tomcat.
    id 'war'
}

// Configurações gerais do grupo e versão do projeto.
group 'com.compliancesys'
version '1.0-SNAPSHOT'

// Define o repositório Maven Central para buscar as dependências.
repositories {
    mavenCentral()
}

// Configurações para o compilador Java.
java {
    // Define a versão do Java a ser usada para compilação e execução.
    // O projeto requer Java 8 ou superior.
    sourceCompatibility = JavaVersion.VERSION_1_8
    targetCompatibility = JavaVersion.VERSION_1_8

    // === ADICIONADO: Configuração de toolchain para Java 8 ===
    // Isso instrui o Gradle a procurar e usar um JDK 8 para compilação e execução,
    // mesmo que o Java padrão do sistema seja uma versão mais recente.
    toolchain {
        languageVersion = JavaLanguageVersion.of(8)
    }
    // =======================================================

    sourceSets {
        main {
            java.srcDirs = [project.file('src/main/java')]
            resources.srcDirs = [project.file('src/main/resources')]
        }
        test {
            java.srcDirs = [project.file('src/test/java')]
            resources.srcDirs = [project.file('src/test/resources')]
        }
    }
}

// Configuração das dependências do projeto.
dependencies {
    // Dependências de compilação e tempo de execução para o projeto principal.
    implementation 'javax.servlet:javax.servlet-api:4.0.1' // API Servlet para aplicações web
    implementation 'com.google.code.gson:gson:2.10.1' // Biblioteca Gson para JSON
    implementation 'org.postgresql:postgresql:42.7.3' // Driver JDBC para PostgreSQL

    // Dependências de teste.
    // JUnit Jupiter API para escrever testes.
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.10.0'
    // JUnit Jupiter Engine para executar testes.
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.10.0'

    // === CORRIGIDO: Mockito para compatibilidade com Java 8 ===
    // Mockito para criar mocks em testes unitários.
    testImplementation 'org.mockito:mockito-core:3.12.4' // Versão compatível com Java 8
    testImplementation 'org.mockito:mockito-junit-jupiter:3.12.4' // Versão compatível com Java 8
    // =========================================================

    // === ADICIONADO: Dependência para o H2 Database (banco de dados em memória para testes) ===
    testImplementation 'com.h2database:h2:2.2.224' // Use a versão mais recente compatível
    // ========================================================================================
}

// Configuração da tarefa de teste.
test {
    // Usa a plataforma JUnit para executar os testes.
    useJUnitPlatform()
    // Garante que os testes falhem se houver erros.
    failFast = true
    testLogging {
        events "passed", "skipped", "failed"
    }

    // Configuração explícita para o relatório HTML dos testes.
    reports {
        html.required = true // Garante que o relatório HTML seja gerado.
        html.outputLocation = file("${buildDir}/reports/tests/test") // Define o diretório de saída.
    }
}

// Configuração da tarefa WAR para o nome do arquivo de saída.
war {
    // Define o nome do arquivo WAR gerado.
    archiveFileName = "${project.name}.war"
}
